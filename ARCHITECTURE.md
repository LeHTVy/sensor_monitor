# Kiáº¿n trÃºc Há»‡ thá»‘ng Honeypot - Capture Server

## ğŸ“Š SÆ¡ Ä‘á»“ Kiáº¿n trÃºc Tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PUBLIC INTERNET                                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Hacker / Attacker                             â”‚   â”‚
â”‚  â”‚                    (Public IP)                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚ HTTP/HTTPS (Port 80/443)             â”‚
â”‚                                  â”‚                                       â”‚
â”‚                                  â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              HONEYPOT SERVER (172.235.245.60)                    â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Public Interface (eth0)                                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Port 80 (HTTP) â†’ Public                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Port 443 (HTTPS) â†’ Public                              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Docker Container: honeypot-server                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Nginx (Port 80/443)                                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â†“ proxy                                           â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Gunicorn (Port 5000)                                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â†“ Flask App                                       â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Request Handler (before_request)              â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚    â†“ Log Entry                                 â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Background Queue (queue.Queue)                â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚    â†“ Kafka Worker Thread                       â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Kafka Producer                                 â”‚ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Ollama Container (MySQL Console AI)                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Port 11434                                       â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  WireGuard VPN Interface (wg0)                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  IP: 10.8.0.2/24                                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Peer: Capture Server (10.8.0.1)                         â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Kafka Producer connects to:                                     â”‚   â”‚
â”‚  â”‚  â†’ 10.8.0.1:9093 (Kafka via VPN)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                       â”‚
â”‚                                  â”‚ WireGuard VPN (10.8.0.2 â†’ 10.8.0.1)  â”‚
â”‚                                  â”‚ Kafka Messages (Port 9093)           â”‚
â”‚                                  â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRIVATE VPN NETWORK (10.8.0.0/24)                    â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           CAPTURE SERVER (172.232.224.160)                      â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  WireGuard VPN Interface (wg0)                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  IP: 10.8.0.1/24                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Peers:                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    - Honeypot (10.8.0.2)                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    - Client (10.8.0.3)                                      â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Docker Network: sensor-network                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Kafka Container                                     â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Internal: kafka:9092 (for collector)              â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - External: 10.8.0.1:9093 (for honeypot via VPN)    â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Topics:                                             â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ honeypot-attacks                                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ honeypot-browser                                 â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ honeypot-traffic                                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ honeypot-errors                                 â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Collector Container                                  â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Consumes: kafka:9092 (internal)                   â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Consumer Group: capture-es-collector              â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Auto Offset Reset: earliest                       â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â†“ Batch Processing (50 logs, 500ms flush)        â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Elasticsearch Indexing                              â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â†“ Index Names:                                    â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚      â€¢ sensor-logs-attacks                           â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚      â€¢ sensor-logs-honeypot                          â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚      â€¢ sensor-logs-traffic                           â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Elasticsearch Container                              â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Port: 9200 (bound to 10.8.0.1:9200)               â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Indices: sensor-logs-*                             â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Backend API Container                                â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Port: 8082 (bound to 10.8.0.1:8082)               â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Endpoints:                                        â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ GET /api/logs (query ES)                        â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    â€¢ GET /api/stats (query ES)                       â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Frontend Container                                   â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Port: 3000 (bound to 10.8.0.1:3000)               â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  - Vue 3 + Vuetify                                   â”‚ â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ WireGuard VPN (10.8.0.1 â†’ 10.8.0.3)
                                   â”‚ HTTP/HTTPS (Port 3000, 8082)
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN CLIENT (10.8.0.3)                               â”‚
â”‚                    - Browser access to Frontend                         â”‚
â”‚                    - API access to Backend                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Luá»“ng Dá»¯ liá»‡u Chi tiáº¿t

### 1. Request Flow (Hacker â†’ Honeypot)

```
[1] Hacker Request
    â†“
[2] Nginx (Port 80/443) - Public Interface
    â†“ (proxy_pass)
[3] Gunicorn (Port 5000) - Internal
    â†“ (Flask before_request)
[4] HoneypotLogger.log_request()
    â†“ (detect attack, geoip, etc.)
[5] Log Entry Created
    â†“
[6] Background Queue (queue.Queue)
    â†“ (non-blocking, async)
[7] Kafka Worker Thread
    â†“ (send to Kafka)
[8] Kafka Producer â†’ 10.8.0.1:9093 (via VPN)
    â†“
[9] Response to Hacker (immediate, khÃ´ng Ä‘á»£i Kafka)
```

### 2. Log Processing Flow (Kafka â†’ Elasticsearch)

```
[1] Kafka Topic (honeypot-attacks/honeypot-browser/honeypot-traffic)
    â†“ (messages queued)
[2] Collector Consumer (kafka:9092 - internal)
    â†“ (consume from topics)
[3] Batch Processing
    - Batch size: 50 logs
    - Flush interval: 500ms
    â†“
[4] Normalize & Enrich
    - Add log_category
    - Add @ingested_at
    - Normalize IP fields
    â†“
[5] Elasticsearch Bulk Index
    - Index: sensor-logs-attacks/honeypot/traffic
    â†“
[6] Data Available in Elasticsearch
```

### 3. Frontend Query Flow (Client â†’ Frontend)

```
[1] Browser (10.8.0.3)
    â†“ (HTTP GET)
[2] Frontend (10.8.0.1:3000)
    â†“ (API call)
[3] Backend API (10.8.0.1:8082)
    â†“ (query Elasticsearch)
[4] Elasticsearch (10.8.0.1:9200)
    â†“ (return results)
[5] Backend API
    â†“ (format response)
[6] Frontend (display logs)
```

## ğŸ” Debug Points - Táº¡i sao khÃ´ng cÃ³ data?

### Checkpoint 1: Honeypot â†’ Kafka
```bash
# TrÃªn Honeypot server
docker logs honeypot-server | grep -i "kafka\|queue\|sent"
# TÃ¬m:
# - "âœ… Kafka background worker started"
# - "ğŸ“¥ Received first message" hoáº·c "Sent log to Kafka"
# - "Kafka queue full" (náº¿u queue Ä‘áº§y)
```

### Checkpoint 2: Kafka Topics
```bash
# TrÃªn Capture server
docker exec kafka kafka-topics --list --bootstrap-server localhost:9092
docker exec kafka kafka-run-class kafka.tools.GetOffsetShell \
  --broker-list localhost:9092 \
  --topic honeypot-traffic 2>/dev/null | awk -F: '{sum += $3} END {print sum}'
```

### Checkpoint 3: Collector â†’ Elasticsearch
```bash
# TrÃªn Capture server
docker logs collector | tail -50
# TÃ¬m:
# - "âœ… Kafka consumer connected"
# - "ğŸ“¥ Received first message"
# - "ğŸ“¤ Indexed X documents"
```

### Checkpoint 4: Elasticsearch Indices
```bash
# TrÃªn Capture server
curl http://localhost:9200/_cat/indices?v | grep sensor-logs
curl http://localhost:9200/sensor-logs-*/_count
```

### Checkpoint 5: VPN Connectivity
```bash
# TrÃªn Honeypot server
ping 10.8.0.1
telnet 10.8.0.1 9093

# TrÃªn Capture server
ping 10.8.0.2
wg show
```

## âš ï¸ CÃ¡c Váº¥n Ä‘á» CÃ³ thá»ƒ Xáº£y ra

1. **Kafka khÃ´ng nháº­n messages tá»« Honeypot**
   - VPN khÃ´ng káº¿t ná»‘i
   - Kafka listener khÃ´ng bind Ä‘Ãºng IP
   - Firewall block port 9093

2. **Collector khÃ´ng consume messages**
   - Consumer group offset Ä‘Ã£ commit (earliest vs latest)
   - Collector khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c Kafka internal
   - Topics khÃ´ng tá»“n táº¡i

3. **Elasticsearch khÃ´ng index**
   - Collector khÃ´ng flush batch
   - Elasticsearch mapping lá»—i
   - Index template khÃ´ng Ä‘Ãºng

4. **Frontend khÃ´ng query Ä‘Æ°á»£c**
   - Backend khÃ´ng káº¿t ná»‘i Elasticsearch
   - API endpoint lá»—i
   - Date filter sai format

